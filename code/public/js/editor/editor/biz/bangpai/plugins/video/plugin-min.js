KISSY.Editor.add("bangpai-video",function(e){function h(a){for(var b=0;b<i.length;b++){var d=i[b];if(d.reg.test(a))return d}}var f=KISSY.Editor,g=e.htmlDataProcessor,j=g&&g.dataFilter,i=[{reg:/youku\.com/i,width:480,height:400,detect:function(a){var b=a.match(/id_([^.]+)\.html$/);if(b)return"http://player.youku.com/player.php/sid/"+b[1]+"/v.swf";b=a.match(/v_playlist\/([^.]+)\.html$/);if(!b)return a}},{reg:/tudou\.com/i,width:480,height:400,detect:function(a){return a}},{reg:/ku6\.com/i,width:480,
height:400,detect:function(a){var b=a.match(/show[^\/]*\/([^.]+)\.html$/);if(b)return"http://player.ku6.com/refer/"+b[1]+"/v.swf";return a}}],c=e.cfg.pluginConfig;c["bangpai-video"]=c["bangpai-video"]||{};c=c["bangpai-video"];c.providers&&i.push.apply(i,c.providers);c.getProvider=h;j&&j.addRules({elements:{object:function(a){var b=a.attributes;if(!(b.classid&&String(b.classid).toLowerCase())){for(b=0;b<a.children.length;b++)if(a.children[b].name=="embed"){if(!f.Utils.isFlashEmbed(a.children[b]))break;
if(h(a.children[b].attributes.src))return g.createFakeParserElement(a,"ke_video","bangpai-video",true)}return null}for(b=0;b<a.children.length;b++){var d=a.children[b];if(d.name=="param"&&d.attributes.name=="movie")if(h(d.attributes.value))return g.createFakeParserElement(a,"ke_video","bangpai-video",true)}},embed:function(a){if(!f.Utils.isFlashEmbed(a))return null;if(h(a.attributes.src))return g.createFakeParserElement(a,"ke_video","bangpai-video",true)}}},4);e.addPlugin("bangpai-video",function(){var a=
e.addButton("bangpai-video",{contentCls:"ke-toolbar-video",title:"\u63d2\u5165\u89c6\u9891",mode:f.WYSIWYG_MODE,loading:true});f.use("bangpai-video/support",function(){var b=new f.BangPaiVideo(e);a.reload({offClick:function(){b.show()},destroy:function(){b.destroy()}})});this.destroy=function(){a.destroy()}})},{attach:false,requires:["fakeobjects"]});
