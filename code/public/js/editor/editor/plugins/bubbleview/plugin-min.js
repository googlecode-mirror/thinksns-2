KISSY.Editor.add("bubbleview",function(){function n(a){a=g[a];if(!a.bubble){a.bubble=new h({autoRender:true});a.cfg.init&&a.cfg.init.call(a.bubble)}return a.bubble}var i=KISSY,j=i.Editor,m=i.Event,o=i.DOM;if(j.BubbleView)i.log("attach bubbleview more","warn");else{var h=i.UIBase.create(j.Overlay,[],{renderUI:function(){this.get("el").addClass("ke-bubbleview-bubble")},show:function(){var a=this._selectedEl,d=a._4e_getOffset(document);d.top+=a.height()+5;this.set("xy",[d.left,d.top]);var f,k;for(k in g){a=
g[k];if(a.bubble){var c;if(c=this!=a.bubble){if(c=a.bubble.get("visible")){var b=a.bubble;c=this.get("y");var e=c+this.get("el")[0].offsetHeight,l=b.get("y");b=l+b.get("el")[0].offsetHeight;c=!(e<l||b<c)}c=c}if(c)if(f){if(f.get("y")<a.bubble.get("y"))f=a.bubble}else f=a.bubble}}if(f=f)d.top=f.get("y")+f.get("el")[0].offsetHeight;h.superclass.show.call(this);this.set("xy",[d.left,d.top])},destructor:function(){j.Utils.destroyRes.call(this)}},{ATTRS:{focus4e:{value:false},zIndex:{value:j.baseZIndex(j.zIndexManager.BUBBLE_VIEW)}}}),
g={};h.destroy=function(a){if((a=g[a])&&a.bubble){a.bubble.destroy();a.bubble=null}};h.attach=function(a){var d=a.pluginName;i.mix(a,g[d].cfg,false);var f=a.pluginContext,k=a.func,c=a.editor,b=a.bubble;c.on("selectionChange",function(e){e=e.path;var l=e.elements;if(e&&l)if(e=e.lastElement)if(e=k(e)){b=n(d);b._selectedEl=e;b._plugin=f;b.hide();setTimeout(function(){b.show()},10)}else if(b){b._selectedEl=b._plugin=null;b.hide()}});c.on("sourcemode",function(){b&&b.hide()});m.on(o._4e_getWin(c.document),
"scroll blur",function(){b&&b.hide()})};h.register=function(a){var d=a.pluginName;g[d]=g[d]||{cfg:a};m.on(document,"click",function(){a.bubble&&a.bubble.hide()});a.editor&&h.attach(a)};j.BubbleView=h}},{attach:false,requires:["overlay"]});
