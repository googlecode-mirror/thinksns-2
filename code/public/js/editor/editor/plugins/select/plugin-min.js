KISSY.Editor.add("select",function(){function h(a){h.superclass.constructor.call(this,a);this._init()}var i=KISSY,k=i.Node,p=i.Event,l=i.DOM,j=i.Editor;if(!j.Select){h.DISABLED=0;h.ENABLED=1;var q=j.XHTML_DTD;h.ATTRS={showValue:{},el:{},cls:{},container:{},doc:{},value:{},width:{},title:{},items:{},align:{value:["l","b"]},menuContainer:{valueFn:function(){for(var a=this.el.parent();a;){var b=a._4e_name();if(q[b]&&q[b].div)return a;a=a.parent()}return new k(document.body)}},state:{value:1}};h.decorate=
function(a){for(var b=a.width(),c=[],d=a.all("option"),e=0;e<d.length;e++){var f=d[e];c.push({name:l.html(f),value:l.attr(f,"value")})}return new h({width:b+"px",el:a,items:c,cls:"ke-combox",value:a.val()})};i.extend(h,i.Base,{_init:function(){var a=this.get("container"),b=this.get("el"),c=new k("<span class='ke-select-wrap'><a onclick='return false;' class='ke-select'><span class='ke-select-text'><span class='ke-select-text-inner'></span></span><span class='ke-select-drop-wrap'><span class='ke-select-drop'></span></span></a></span>"),
d=this.get("title")||"",e=this.get("cls"),f=c.one(".ke-select-text"),g=c.one(".ke-select-text-inner");c.one(".ke-select-drop");this.get("value")!==undefined?g.html(this._findNameByV(this.get("value"))):g.html(d);f.css("width",this.get("width"));c._4e_unselectable();d&&c.attr("title",d);e&&c.addClass(e);if(b)b[0].parentNode.replaceChild(c[0],b[0]);else a&&c.appendTo(a);c.on("click",this._click,this);this.el=c;this.title=g;this._focusA=c.one("a.ke-select");j.Utils.lazyRun(this,"_prepare","_real");this.on("afterValueChange",
this._valueChange,this);this.on("afterStateChange",this._stateChange,this)},_findNameByV:function(a){var b=this.get("title")||"",c=this.get("items");if(this.get("showValue"))return a||b;for(var d=0;d<c.length;d++){var e=c[d];if(e.value==a){b=e.name;break}}return b},_valueChange:function(a){this.title.html(this._findNameByV(a.newVal))},_itemsChange:function(a){a=a.newVal;var b=this._selectList;b.html("");if(a)for(var c=0;c<a.length;c++){var d=a[c];(new k("<a class='ke-select-menu-item' href='#' data-value='"+
d.value+"'>"+d.name+"</a>",d.attrs)).appendTo(b)._4e_unselectable()}this.as=b.all("a")},val:function(a){if(a!==undefined){this.set("value",a);return this}else return this.get("value")},_resize:function(){this.menu.get("visible")&&this._real()},_prepare:function(){var a=this,b=a.el,c=a.get("popUpWidth"),d=a._focusA,e=new j.Overlay({render:a.get("menuContainer"),content:"<div>",focus4e:false,elCls:"ke-menu",width:c?c:b.width(),zIndex:j.baseZIndex(j.zIndexManager.SELECT),focusMgr:false}),f=a.get("items");
e.renderer();c=e.get("contentEl").one("div");a.menu=e;p.on(window,"resize",a._resize,a);a.get("title")&&(new k("<div class='ke-menu-title ke-select-menu-item' style='margin-top:-6px;' >"+a.get("title")+"</div>")).appendTo(c);a._selectList=(new k("<div>")).appendTo(c);a._itemsChange({newVal:f});e.on("show",function(){d.addClass("ke-select-active")});e.on("hide",function(){d.removeClass("ke-select-active")});p.on([document,a.get("doc")],"click",function(g){b.contains(g.target)||e.hide()});c.on("click",
a._select,a);a.as=a._selectList.all("a");p.on(c[0],"mouseenter",function(){a.as.removeClass("ke-menu-selected")});a.on("afterItemsChange",a._itemsChange,a);a.menuNode=c},_stateChange:function(a){var b=this.el;a.newVal==1?b.removeClass("ke-select-disabled"):b.addClass("ke-select-disabled")},enable:function(){this.set("state",1)},disable:function(){this.set("state",0)},_select:function(a){a.halt();var b=this.menu,c=this.menuNode;if(a=(new k(a.target))._4e_ascendant(function(f){return c.contains(f)&&
f._4e_name()=="a"},true)){var d=this.get("value"),e=a.attr("data-value");this.set("value",e);this.fire("click",{newVal:e,prevVal:d,name:a.html()});b.hide()}},_real:function(){var a=this.el,b=a.offset(),c=i.clone(b),d=this.menu.get("el").height(),e=this.menu.get("el").width(),f=l.scrollTop(),g=l.scrollLeft(),m=l.viewportHeight(),n=l.viewportWidth();n=g+n-60;m=f+m;var o=b.top+(a.height()-2);a=b.left+a.width()-2;var r=this.get("align"),s=r[0];if(r[1]=="b"){b.top=o;if(b.top+d>m&&c.top-f>m-o)b.top=c.top-
d}else{b.top=c.top-d;if(b.top<f&&c.top-f<m-o)b.top=o}if(s=="l"){if(b.left+e>n&&a-g>n-c.left)b.left=a-e}else{b.left=a-e;if(b.left<g&&a-g<n-c.left)b.left=c.left}this.menu.set("xy",[b.left,b.top]);this.menu.show()},_click:function(a){a.preventDefault();a=this.el;var b=this.get("value");if(!a.hasClass("ke-select-disabled"))if(this._focusA.hasClass("ke-select-active"))this.menu.hide();else{this._prepare();b&&this.menu&&this.as.each(function(c){c.attr("data-value")==b?c.addClass("ke-menu-selected"):c.removeClass("ke-menu-selected")})}}});
j.Select=h}});
