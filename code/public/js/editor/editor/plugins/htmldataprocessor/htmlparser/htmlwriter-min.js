KISSY.Editor.add("htmlparser-htmlwriter",function(){function f(){f.superclass.constructor.call(this);this.indentationChars="\t";this.selfClosingEnd=" />";this.lineBreakChars="\n";this.forceSimpleAmpersand=false;this.sortAttributes=true;this._.indent=false;this._.indentation="";this._.rules={};var b=d.XHTML_DTD,a;for(a in e.mix({},b.$nonBodyContent,b.$block,b.$listItem,b.$tableContent))this.setRules(a,{indent:true,breakBeforeOpen:true,breakAfterOpen:true,breakBeforeClose:!b[a]["#"],breakAfterClose:true});
this.setRules("br",{breakAfterOpen:true});this.setRules("title",{indent:false,breakAfterOpen:false});this.setRules("style",{indent:false,breakBeforeClose:true});this.setRules("pre",{indent:false})}var d=KISSY.Editor,e=d.Utils;if(!d.HtmlParser.HtmlWriter){KISSY.extend(f,d.HtmlParser.BasicWriter,{openTag:function(b){var a=this._.rules[b];if(this._.indent)this.indentation();else if(a&&a.breakBeforeOpen){this.lineBreak();this.indentation()}this._.output.push("<",b)},openTagClose:function(b,a){var c=this._.rules[b];
if(a)this._.output.push(this.selfClosingEnd);else{this._.output.push(">");if(c&&c.indent)this._.indentation+=this.indentationChars}c&&c.breakAfterOpen&&this.lineBreak()},attribute:function(b,a){if(typeof a=="string"){this.forceSimpleAmpersand&&(a=a.replace(/&amp;/g,"&"));a=e.htmlEncodeAttr(a)}this._.output.push(" ",b,'="',a,'"')},closeTag:function(b){var a=this._.rules[b];if(a&&a.indent)this._.indentation=this._.indentation.substr(this.indentationChars.length);if(this._.indent)this.indentation();
else if(a&&a.breakBeforeClose){this.lineBreak();this.indentation()}this._.output.push("</",b,">");a&&a.breakAfterClose&&this.lineBreak()},text:function(b){if(this._.indent){this.indentation();b=e.ltrim(b)}this._.output.push(b)},comment:function(b){this._.indent&&this.indentation();this._.output.push("<!--",b,"--\>")},lineBreak:function(){this._.output.length>0&&this._.output.push(this.lineBreakChars);this._.indent=true},indentation:function(){this._.output.push(this._.indentation);this._.indent=false},
setRules:function(b,a){var c=this._.rules[b];if(c)e.mix(c,a);else this._.rules[b]=a}});d.HtmlParser.HtmlWriter=f}});
