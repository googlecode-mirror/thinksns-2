KISSY.add("dd",function(c){function e(){e.superclass.constructor.apply(this,arguments);this._init()}function i(a,b,d){d=d||150;if(d===-1)return function(){a.apply(b,arguments)};var g=c.now();return function(){var h=c.now();if(h-g>d){g=h;a.apply(b,arguments)}}}var f=c.Event,j=c.DOM,k=c.Node;c.DD={};e.ATTRS={bufferTime:{value:200},activeDrag:{}};c.extend(e,c.Base,{_init:function(){this._showShimMove=i(this._move,this,30)},_move:function(a){var b=this.get("activeDrag");c.log("move");if(b){a.preventDefault();
this._clearSelection();b._move(a)}},_start:function(a){var b=this,d=b.get("bufferTime")||0;b._registerEvent();if(d)b._bufferTimer=setTimeout(function(){b._bufferStart(a)},d);else b._bufferStart(a)},_bufferStart:function(a){this.set("activeDrag",a);this._activeShim();a._start()},_end:function(a){var b=this.get("activeDrag");this._unregisterEvent();if(this._bufferTimer){clearTimeout(this._bufferTimer);this._bufferTimer=null}this._shim&&this._shim.css({display:"none"});if(b){b._end(a);this.set("activeDrag",
null)}},_activeShim:function(){var a=document;this._shim=(new k("<div style='background-color:red;position:absolute;left:0;width:100%;top:0;z-index:999999;'></div>")).appendTo(a.body);this._shim.css("opacity",0);this._activeShim=this._showShim;this._showShim()},_showShim:function(){this._shim.css({display:"",height:j.docHeight()});this._clearSelection()},_clearSelection:function(){c.log("_clearSelection");if(window.getSelection)window.getSelection().removeAllRanges();else if(document.selection)try{document.selection.empty()}catch(a){}},
_registerEvent:function(){var a=document;c.log("_registerEvent");f.on(a,"mouseup",this._end,this);f.on(a,"mousemove",this._showShimMove,this)},_unregisterEvent:function(){var a=document;c.log("_unregisterEvent");f.remove(a,"mousemove",this._showShimMove,this);f.remove(a,"mouseup",this._end,this)}});c.DD.DDM=new e});
